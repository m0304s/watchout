# 브랜치 전략

## 1. 브랜치 구조

### 1.1 메인 브랜치 (AI/BE/FE 분리)
- **main-ai**: AI 프로덕션 배포용 브랜치
- **main-be**: Backend 프로덕션 배포용 브랜치  
- **main-fe**: Frontend 프로덕션 배포용 브랜치
- **dev-ai**: AI 개발 통합 브랜치
- **dev-be**: Backend 개발 통합 브랜치
- **dev-fe**: Frontend 개발 통합 브랜치

```
main-ai          main-be          main-fe
    │                │                │
    └── dev-ai       └── dev-be       └── dev-fe
            │                │                │
            ├── feat/기능명   ├── feat/기능명   ├── feat/기능명
            ├── hotfix/기능명 ├── hotfix/기능명 ├── hotfix/기능명
            └── release-버전  └── release-버전  └── release-버전
```

### 1.2 브랜치 종류

#### Feature 브랜치
- **목적**: 새로운 기능 개발
- **네이밍**: `feat/기능명`
- **예시**: `feat/cctv-list`, `feat/user-authentication`

#### Hotfix 브랜치
- **목적**: 프로덕션 버그 긴급 수정
- **네이밍**: `hotfix/기능명
- **예시**: `hotfix/cctv-list`, `hotfix/user-authentication`

#### Release 브랜치
- **목적**: 배포 준비 및 테스트
- **네이밍**: `release-버전명`
- **예시**: `release-v1.0.0`, `release-v1.1.0`

## 2. 브랜치 생성 규칙

### 2.1 Feature 브랜치 생성
```bash
# AI 개발 브랜치 생성
git checkout dev-ai
git pull origin dev-ai
git checkout -b feat/cctv-detection

# Backend 개발 브랜치 생성
git checkout dev-be
git pull origin dev-be
git checkout -b feat/user-authentication

# Frontend 개발 브랜치 생성
git checkout dev-fe
git pull origin dev-fe
git checkout -b feat/cctv-list
```

### 2.2 Hotfix 브랜치 생성
```bash
# AI 긴급 수정
git checkout main-ai
git pull origin main-ai
git checkout -b hotfix/rag

# Backend 긴급 수정
git checkout main-be
git pull origin main-be
git checkout -b hotfix/user

# Frontend 긴급 수정
git checkout main-fe
git pull origin main-fe
git checkout -b hotfix/user
```

### 2.3 Release 브랜치 생성
```bash
# AI 배포 준비
git checkout dev-ai
git pull origin dev-ai
git checkout -b release-v1.0.0-ai

# Backend 배포 준비
git checkout dev-be
git pull origin dev-be
git checkout -b release-v1.0.0-be

# Frontend 배포 준비
git checkout dev-fe
git pull origin dev-fe
git checkout -b release-v1.0.0-fe
```

## 3. 브랜치 네이밍 컨벤션

### 3.1 기본 규칙
- **소문자** 사용
- **하이픈(-)** 으로 단어 구분
- **의미있는 이름** 사용
- **한글 사용 금지**

### 3.2 네이밍 예시

#### Feature 브랜치
```
feat/cctv-detection     # AI CCTV 객체 탐지 기능
feat/user-authentication # Backend 사용자 인증 API
feat/cctv-list          # Frontend CCTV 목록 UI
feat/database-schema    # 데이터베이스 스키마 변경
```

#### Hotfix 브랜치
```
hotfix/ai  # AI 모델 오류 수정
hotfix/api  # Backend API 버그 수정
hotfix/rendering  # Frontend 렌더링 오류 수정
```

#### Release 브랜치
```
release-v1.0.0-ai   # AI 모델 배포
release-v1.0.0-be   # Backend API 배포
release-v1.0.0-fe   # Frontend 배포
```

## 4. 브랜치 워크플로우

### 4.1 Feature 개발 워크플로우

#### 단계별 진행
1. **브랜치 생성**: 해당 dev 브랜치에서 feat/기능명 브랜치 생성
2. **개발 진행**: 기능 구현 및 테스트
3. **Pull Request**: 해당 dev 브랜치로 PR 생성
4. **Code Review**: 팀원 리뷰 진행
5. **병합**: dev 브랜치에 병합
6. **브랜치 삭제**: feat 브랜치 삭제

### 4.2 Hotfix 워크플로우

#### 단계별 진행
1. **브랜치 생성**: 해당 main 브랜치에서 hotfix-버그ID 브랜치 생성
2. **버그 수정**: 긴급 버그 수정
3. **main 병합**: 수정사항을 해당 main 브랜치에 병합
4. **dev 병합**: main의 변경사항을 해당 dev 브랜치에 병합
5. **브랜치 삭제**: hotfix 브랜치 삭제

### 4.3 Release 워크플로우

#### 단계별 진행
1. **브랜치 생성**: 해당 dev 브랜치에서 release-버전명 브랜치 생성
2. **배포 준비**: 버전 정보 업데이트, 문서 작성
3. **테스트**: 통합 테스트 진행
4. **main 병합**: release를 해당 main 브랜치에 병합
5. **dev 병합**: main의 변경사항을 해당 dev 브랜치에 병합
6. **태그 생성**: 버전 태그 생성
7. **브랜치 삭제**: release 브랜치 삭제

## 5. 브랜치 보호 규칙

### 5.1 main 브랜치 보호 (main-ai, main-be, main-fe)
- **직접 푸시 금지**
- **Pull Request 필수**
- **Code Review 필수** (최소 1명)
- **상태 검사 통과 필수**

### 5.2 dev 브랜치 보호 (dev-ai, dev-be, dev-fe)
- **직접 푸시 금지**
- **Pull Request 필수**
- **Code Review 권장** (최소 1명)
- **상태 검사 통과 필수**

## 6. 브랜치 관리 규칙

### 6.1 브랜치 삭제
- **병합 완료 후 즉시 삭제**
- **원격 브랜치도 함께 삭제**

```bash
# 로컬 브랜치 삭제
git branch -d feature/user-profile

# 원격 브랜치 삭제
git push origin --delete feature/user-profile
```

### 6.2 브랜치 동기화
- **작업 시작 전 최신 상태로 동기화**
- **작업 완료 후 최신 상태로 동기화**

```bash
# dev 브랜치 최신화
git checkout dev-ai
git pull origin dev-ai

# feature 브랜치 최신화
git checkout feat/cctv-detection
git rebase dev-ai
```

## 7. 충돌 해결

### 7.1 충돌 발생 시
1. **충돌 파일 확인**
2. **충돌 내용 분석**
3. **수동으로 충돌 해결**
4. **테스트 진행**
5. **커밋 완료**

### 7.2 충돌 방지 방법
- **작은 단위로 자주 커밋**
- **작업 시작 전 최신 상태로 동기화**
- **팀원과 작업 영역 분담**

## 8. 브랜치 전략 예시

### 8.1 일반적인 개발 시나리오

```bash
# 1. Frontend 개발 시작
git checkout dev-fe
git pull origin dev-fe
git checkout -b feat/cctv-list

# 2. 개발 진행
git add .
git commit -m "[FE] feat: CCTV 목록 컴포넌트 구현"

# 3. 개발 완료 후 PR 생성
git push origin feat/cctv-list
# GitLab에서 Pull Request 생성

# 4. 리뷰 완료 후 병합
git checkout dev-fe
git pull origin dev-fe
git branch -d feat/cctv-list
git push origin --delete feat/cctv-list
```

### 8.2 긴급 버그 수정 시나리오

```bash
# 1. Backend 긴급 수정 시작
git checkout main-be
git pull origin main-be
git checkout -b hotfix/be

# 2. 버그 수정
git add .
git commit -m "[BE] fix: 로그인 인증 오류 수정"

# 3. main-be에 병합
git checkout main-be
git merge hotfix/be
git push origin main-be

# 4. dev-be에 병합
git checkout dev-be
git merge main-be
git push origin dev-be

# 5. 브랜치 정리
git branch -d hotfix/be
git push origin --delete hotfix/be
```

## 9. 브랜치 전략 체크리스트

### 9.1 브랜치 생성 시
- [ ] 적절한 브랜치명 사용
- [ ] 올바른 베이스 브랜치에서 생성
- [ ] 브랜치 목적이 명확한지 확인

### 9.2 개발 진행 시
- [ ] 정기적으로 최신 상태로 동기화
- [ ] 작은 단위로 자주 커밋
- [ ] 의미있는 커밋 메시지 작성

### 9.3 병합 전
- [ ] 코드 리뷰 완료
- [ ] 테스트 통과
- [ ] 충돌 해결 완료
- [ ] 문서 업데이트

### 9.4 병합 후
- [ ] 브랜치 삭제
- [ ] 원격 브랜치 삭제
- [ ] 태그 생성 (release 시)

## 10. GitLab 관련 에러 해결

### 10.1 Content Security Policy (CSP) 에러

#### 에러 메시지
```
Refused to frame 'https://lab.ssafy.com/' because an ancestor violates the following Content Security Policy directive: "frame-ancestors project.ssafy.com".
```

#### 에러 원인
- **CSP (Content Security Policy)** 정책 위반
- GitLab이 `frame-ancestors` 정책을 통해 특정 도메인에서만 iframe으로 로드되도록 제한
- 현재 도메인이 `project.ssafy.com`이 아닌 다른 도메인에서 접근 시 발생

#### 해결 방법

##### 1. 직접 URL 접근
```bash
# GitLab Lab 사이트에 직접 접근
https://lab.ssafy.com/
```

##### 2. 프로젝트 사이트에서 접근
```bash
# SSAFY 프로젝트 사이트에서 GitLab Lab 링크 클릭
https://project.ssafy.com/
```

##### 3. 브라우저 설정 변경 (임시 해결)
- **Chrome**: `chrome://settings/content/all` → `lab.ssafy.com` → "허용" 설정
- **Firefox**: `about:config` → `security.csp.enable` → `false` (권장하지 않음)

##### 4. 개발자 도구에서 확인
```javascript
// 콘솔에서 CSP 정책 확인
console.log(document.querySelector('meta[http-equiv="Content-Security-Policy"]'));
```

#### 예방 방법
- **정식 경로 사용**: SSAFY 프로젝트 사이트를 통한 접근
- **북마크 설정**: `https://lab.ssafy.com/` 직접 북마크
- **브라우저 확장 프로그램**: CSP 우회 확장 프로그램 사용 (보안상 권장하지 않음)

#### 추가 정보
- **CSP 정책**: 웹 보안을 위한 브라우저 보안 기능
- **frame-ancestors**: iframe으로 로드할 수 있는 상위 페이지 도메인 제한
- **SSAFY 정책**: 교육 환경 보안을 위한 도메인 제한 설정
